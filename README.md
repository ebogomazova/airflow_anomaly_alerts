## Система алертов по ключевым метрикам приложения

**Задача:**

Разработать автоматизированную систему оповещений, которая будет мониторить ключевые метрики приложения и отправлять уведомления в Telegram в случае обнаружения аномалий. Отчет должен обеспечить возможность оперативно выявлять и реагировать на аномальные изменения ключевых метрик приложения.  

**Функциональные требования:**

1.  **Метрики:**
    Отчет должен содержать следующие ключевые метрики:
    *   **Активные пользователи Ленты новостей и Мессенджера**
    *   **Просмотры и Лайки Ленты новостей**
    *   **CTR:**
        *   Отношение лайков к просмотрам в **Ленте новостей**
    *   **Количество отправленных сообщений в Мессенджере**.

2.  **Формат и содержание отчета:**
    *  Отчет должен отправляться как сообщение в телеграм, в случае обнаружения аномалии.
    *  Отчет должен содержать информацию: метрика, ее текущее значение, величина отклонения, время обнаружения аномалии.
    *  Отчет должен сопровождаться графиком и ссылкой на оперативный дашборд в Superset.

**Описание решения:**

Система оповещений разработана на основе анализа ключевых метрик приложения с использованием статистического метода межквартильного размаха (IQR). Этот метод выбран из-за его устойчивости к выбросам и отсутствию требования нормального распределения данных.

**Алгоритм обнаружения аномалий:**

Для каждой метрики строится доверительный интервал на основе межквартильного размаха.  Выход значения метрики за пределы этого интервала считается аномалией.

* **Параметр `a` (ширина интервала):**  Определяет ширину доверительного интервала, вычисляемого как `IQR * a`.  Значение `a = 3` выбрано эмпирически, обеспечивая баланс между чувствительностью системы и частотой ложных срабатываний.  Увеличение значения `a` расширяет доверительный интервал, снижая частоту ложных срабатываний, но увеличивая риск пропуска истинных аномалий. Уменьшение значения `a` сужает интервал, делая систему более чувствительной, но увеличивая вероятность ложных срабатываний.

* **Параметр `n` (количество периодов):** Определяет количество периодов, используемых для расчета межквартильного размаха. Значение `n = 5` выбрано на основе анализа внутридневной и недельной сезонности метрик.  Анализ показал, что за неделю поведение метрик достаточно стабильно, без необходимости учета дня недели.  Изменение значения `n` влияет на чувствительность системы к долгосрочным трендам. Увеличение `n` делает систему более устойчивой к краткосрочным колебаниям, но менее чувствительной к резким изменениям.

**Уведомления в Telegram:**

Система каждые 15 минут проверяет ключевые метрики. При обнаружении аномалии отправляется уведомление в Telegram, содержащее:

*   Список метрик, по которым произошли аномалии.
*   Время обнаружения аномалии.
*   Текущее значение метрики.
*   Величина отклонения от доверительного интервала.
*   Ссылка на оперативный дашборд в Superset с детальной информацией о метриках.

**Реализация проекта:**

Реализация проекта аналогична проекту 2, с использованием Python, Apache Airflow и бота Telegram. Создан DAG, который запускается каждые 15 минут и выполняет следующие действия:

1.  Сбор данных о метриках.
2.  Анализ данных и определение аномалий.
3.  Формирование и отправка уведомлений в Telegram.

## Визуализация процесса в Airflow

Ниже представлен общий вид DAG в Apache Airflow:

![dag_project3](https://github.com/user-attachments/assets/6b42181f-18d9-4bba-9624-18157daf0bf5)

## Код

Ознакомится с кодом можно в "dag_project_anomaly_alerts.py"

## Результат работы DAG: Алерт в Telegram

Ниже показан пример алерта, отправляемого в Telegram:

![dag_project3-2](https://github.com/user-attachments/assets/23447901-f4c0-4232-87de-ba16e9265f11)
![dag_project3-1](https://github.com/user-attachments/assets/59692f7f-e6b6-4d9d-af54-36c3732bc9e9)

**Технологии:**

*   Python
*   Apache Airflow
*   Apache Superset
